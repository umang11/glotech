steal("jquery/controller",function($){$.Controller("MP.Preloader",{myThis:null},{stages:{Navbar:false,Language:false,Iframe:false,LeftBar:false,DragDrop:false},loaded:0,step:null,knob:null,init:function(){MP.Preloader.myThis=this;this.step=Math.round(100/Object.keys(this.stages).length*100)/100;this.knob=this.element.find("#motopress-knob");this.set()},reopen:function(){for(var stage in this.stages){if(stage==="Navbar"||stage==="Language"){delete this.stages[stage]}else{this.stages[stage]=false}}},show:function(){this.loaded=0;this.set();this.element.show()},hide:function(){this.element.fadeOut("slow");MP.Flash.showMessage()},load:function(stage){if(this.stages.hasOwnProperty(stage)&&!this.stages[stage]){this.stages[stage]=true;this.loaded+=this.step;this.set()}},set:function(){this.knob.val(this.loaded).trigger("change")}})});steal("jquery/controller","jquery/view/ejs").then("mp/core/flash/views/init.ejs"+motopress.pluginVersionParam,function($){$.Controller("MP.Flash",{type:"warning",message:null,cssClass:"alert fade in",newCssClass:"",element:null,setFlash:function(message,type){MP.Flash.message=message;if(typeof type!=="undefined"){MP.Flash.type=type}MP.Flash.newCssClass=MP.Flash.cssClass;switch(MP.Flash.type){case"info":MP.Flash.newCssClass+=" alert-info";break;case"success":MP.Flash.newCssClass+=" alert-success";break;case"error":MP.Flash.newCssClass+=" alert-error";break}},showMessage:function(){if(MP.Flash.message){MP.Flash.element.html("//mp/core/flash/views/init.ejs"+motopress.pluginVersionParam,{cssClass:MP.Flash.newCssClass,type:MP.Flash.type,message:MP.Flash.message});var alert=MP.Flash.element.find(".alert");var flashTimer=setTimeout(function(){alert.alert("close");MP.Flash.message="";clearTimeout(flashTimer)},10000)}}},{init:function(){MP.Flash.element=this.element;this.element.html("//mp/core/flash/views/init.ejs"+motopress.pluginVersionParam,{cssClass:MP.Flash.cssClass,type:MP.Flash.type,message:MP.Flash.message})}})});steal("jquery/class",function($){$.Class("MP.Utils",{validationError:$("<div />",{"class":"motopress-validation-error"}),tbStyle:null,wpFrontEndEditorEvents:[],strtr:function(str,from,to){if(typeof from==="object"){var cmpStr="";for(var j=0;j<str.length;j++){cmpStr+="0"}var offset=0;var find=-1;var addStr="";for(fr in from){offset=0;while((find=str.indexOf(fr,offset))!=-1){if(parseInt(cmpStr.substr(find,fr.length))!=0){offset=find+1;continue}for(var k=0;k<from[fr].length;k++){addStr+="1"}cmpStr=cmpStr.substr(0,find)+addStr+cmpStr.substr(find+fr.length,cmpStr.length-(find+fr.length));str=str.substr(0,find)+from[fr]+str.substr(find+fr.length,str.length-(find+fr.length));offset=find+from[fr].length+1;addStr=""}}return str}for(var i=0;i<from.length;i++){str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i))}return str},uniqid:function(prefix,more_entropy){if(typeof prefix=="undefined"){prefix=""}var retId;var formatSeed=function(seed,reqWidth){seed=parseInt(seed,10).toString(16);if(reqWidth<seed.length){return seed.slice(seed.length-reqWidth)}if(reqWidth>seed.length){return Array(1+(reqWidth-seed.length)).join("0")+seed}return seed};if(!this.php_js){this.php_js={}}if(!this.php_js.uniqidSeed){this.php_js.uniqidSeed=Math.floor(Math.random()*123456789)}this.php_js.uniqidSeed++;retId=prefix;retId+=formatSeed(parseInt(new Date().getTime()/1000,10),8);retId+=formatSeed(this.php_js.uniqidSeed,5);if(more_entropy){retId+=(Math.random()*10).toFixed(8).toString()}return retId},version_compare:function(v1,v2,operator){this.php_js=this.php_js||{};this.php_js.ENV=this.php_js.ENV||{};var i=0,x=0,compare=0,vm={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},prepVersion=function(v){v=(""+v).replace(/[_\-+]/g,".");v=v.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return(!v.length?[-8]:v.split("."))},numVersion=function(v){return !v?0:(isNaN(v)?vm[v]||-7:parseInt(v,10))};v1=prepVersion(v1);v2=prepVersion(v2);x=Math.max(v1.length,v2.length);for(i=0;i<x;i++){if(v1[i]==v2[i]){continue}v1[i]=numVersion(v1[i]);v2[i]=numVersion(v2[i]);if(v1[i]<v2[i]){compare=-1;break}else{if(v1[i]>v2[i]){compare=1;break}}}if(!operator){return compare}switch(operator){case">":case"gt":return(compare>0);case">=":case"ge":return(compare>=0);case"<=":case"le":return(compare<=0);case"==":case"=":case"eq":return(compare===0);case"<>":case"!=":case"ne":return(compare!==0);case"":case"<":case"lt":return(compare<0);default:return null}},inObject:function(value,obj){var result=false;for(var key in obj){if(obj[key].toLowerCase()==value.toLowerCase()){result=true;break}}return result},removeByValue:function(value,arr){if(arr.indexOf(value)!==-1){arr.splice(arr.indexOf(value),1);return true}else{return false}},doSortSelectByText:function(select){if(!select.children("optgroup").length){var sortedVals=$.makeArray(select.children("option")).sort(function(a,b){return $(a).text()>$(b).text()?1:$(a).text()<$(b).text()?-1:0});select.empty().html(sortedVals)}else{select.children("optgroup").each(function(){var sortedVals=$.makeArray($(this).children("option")).sort(function(a,b){return $(a).text()>$(b).text()?1:$(a).text()<$(b).text()?-1:0});$(this).empty().html(sortedVals)})}},addParamToUrl:function(url,key,value){var query=url.indexOf("?");var anchor=url.indexOf("#");if(query==url.length-1){url=url.substring(0,query);query=-1}return(anchor>0?url.substring(0,anchor):url)+(query>0?"&"+key+"="+value:"?"+key+"="+value)+(anchor>0?url.substring(anchor):"")},removeParamFromUrl:function(url,param){var expr=new RegExp(param+"\\=([a-z0-9]+)","i");var match=url.match(expr);if(match){var urlPart=match[0];if(url.search("&"+urlPart)>=0){url=url.replace("&"+urlPart,"")}else{if(url.search("\\?"+urlPart+"&")>=0){url=url.replace("?"+urlPart+"&","")}else{if(url.search("\\?"+urlPart)>=0){url=url.replace("?"+urlPart,"")}}}}return url},showValidationError:function(message,afterElement){var oldValidationError=afterElement.next(".motopress-validation-error");if(oldValidationError.length){oldValidationError.remove()}var validationError=this.validationError.clone();validationError.text(message).insertAfter(afterElement)},getScrollbarWidth:function(){var scrollWidth=window.browserScrollbarWidth;if(typeof scrollWidth==="undefined"){var div=$('<div style="width: 50px; height: 50px; position: absolute; left: -100px; top: -100px; overflow: auto;"><div style="width: 1px; height: 100px;"></div></div>');$("body").append(div);scrollWidth=div[0].offsetWidth-div[0].clientWidth;div.remove()}return scrollWidth},getSpanClass:function(classes){var expr=new RegExp("^(span|mp-span)\\d{1,2}$","i");var spanClass=null;for(var i=0;i<classes.length;i++){if(expr.test(classes[i])){spanClass=classes[i];break}}return spanClass},getSpanNumber:function(spanClass){var exprNumber=new RegExp("\\d{1,2}","i");return parseInt(spanClass.match(exprNumber))},notClone:function(span,ui){return(ui===null||(span[0]!==ui.draggable[0]&&span[0]!==ui.helper[0]))?true:false},calcSpanNumber:function(row,ui){var spans=row.children('[class*="span"]');var spanCount=0;if(spans.length){spans.each(function(){if(MP.Utils.notClone($(this),ui)){var spanNumber=MP.Utils.getSpanNumber(MP.Utils.getSpanClass($(this).prop("class").split(" ")));spanCount+=spanNumber}})}return spanCount},getHandleClass:function(classes){var expr=new RegExp("^ui-resizable-(n|e|s|w|se|sw)$","i");var handleClass=null;for(var i=0;i<classes.length;i++){if(expr.test(classes[i])){handleClass=classes[i];break}}return handleClass},setup:function(){var userAgent=navigator.userAgent.toLowerCase();this.Browser={Version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],Chrome:/chrome/.test(userAgent),Safari:/webkit/.test(userAgent),Opera:/opera/.test(userAgent),IE:/msie/.test(userAgent)&&!/opera/.test(userAgent),Mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)}},getEditorActiveMode:function(classes){var expr=new RegExp("^(tmce|html)-active$","i");var activeMode=null;for(var i=0;i<classes.length;i++){if(expr.test(classes[i])){activeMode=classes[i]}}return activeMode},addWindowFix:function(){if(typeof tb_show==="function"&&typeof tb_remove==="function"){this.tbStyle=$("<style />",{type:"text/css",text:"#TB_overlay {z-index: 1051;} #TB_window {z-index: 1052;}"}).appendTo("head")}},removeWindowFix:function(){if(this.tbStyle!==null){this.tbStyle.remove()}},base64_decode:function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1)}else{if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}}while(i<data.length);dec=tmp_arr.join("");dec=this.utf8_decode(dec);return dec},base64_encode:function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}data=this.utf8_encode(data+"");do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");var r=data.length%3;return(r?enc.slice(0,r-3):enc)+"===".slice(r||3)},utf8_decode:function(str_data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;str_data+="";while(i<str_data.length){c1=str_data.charCodeAt(i);if(c1<128){tmp_arr[ac++]=String.fromCharCode(c1);i++}else{if(c1>191&&c1<224){c2=str_data.charCodeAt(i+1);tmp_arr[ac++]=String.fromCharCode(((c1&31)<<6)|(c2&63));i+=2}else{c2=str_data.charCodeAt(i+1);c3=str_data.charCodeAt(i+2);tmp_arr[ac++]=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}}return tmp_arr.join("")},utf8_encode:function(argString){if(argString===null||typeof argString==="undefined"){return""}var string=(argString+"");var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else{if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128)}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128)}}if(enc!==null){if(end>start){utftext+=string.slice(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.slice(start,stringl)}return utftext},nl2br:function(str,is_xhtml){var breakTag=(is_xhtml||typeof is_xhtml==="undefined")?"<br />":"<br>";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")},br2nl:function(str){return str.replace(/<br[^>]*>\s*\r*\n*/g,"\n")},addWpFrontEndEditorFix:function(){var events=$("#post-preview").data("events");if(typeof events!=="undefined"&&events.hasOwnProperty("click")){var clickEvents=events.click.slice();$.each(clickEvents,function(index,value){if(value.handler.toString().indexOf("wp_fee_redirect")!==-1){MP.Utils.wpFrontEndEditorEvents.push(value);$("#post-preview").data("events").click.splice($("#post-preview").data("events").click.indexOf(value),1)}})}},removeWpFrontEndEditorFix:function(){if(this.wpFrontEndEditorEvents.length){$.merge($("#post-preview").data("events").click,this.wpFrontEndEditorEvents);this.wpFrontEndEditorEvents.length=0}}},{})});steal("jquery/controller",function($){$.Controller("CE.Iframe",{myThis:null,window:null,contents:null,tmpPostId:null,wpEditor:null,wpTextarea:null},{grid:$("<div />",{id:"motopress-ce-grid","class":"mp-container"}),divDisablePlugin:$("<div />",{"class":"motopress-disable-plugin"}),init:function(el){CE.Iframe.myThis=this;CE.Iframe.window=this.element[0].contentWindow;CE.Iframe.wpTextarea=$("#wp-content-editor-container #content");el.addClass("motopress-tmp-iframe-width");this.getTinyMCEContent();el.on("load",this.proxy("onLoad"))},onLoad:function(){CE.Navbar.myThis.onIframeLoad(this.element);CE.Iframe.contents=this.element.contents();CE.Iframe.contents.find('link[href*="js_composer"]').remove();MP.Utils.addWpFrontEndEditorFix();var head=CE.Iframe.contents.find("head")[0];var stealVerScript=$("<script />",{text:'var steal = { production: "mp/ce/iframeProd/production.js" + parent.motopress.pluginVersionParam };'})[0];this.appendScript(head,stealVerScript);var script=$("<script />",{src:MP.Settings.pluginRootUrl+"/"+MP.Settings.pluginName+"/steal/steal.production.js?mp/ce/iframeProd"})[0];this.appendScript(head,script);var iframeBody=CE.Iframe.contents.find("body");iframeBody.find("#wp-motopress-tmp-editor-wrap").hide();var sceneContent=iframeBody.find(".motopress-content-wrapper");if(!sceneContent.length){iframeBody.append(CE.Iframe.myThis.divDisablePlugin);if(CE.Iframe.myThis.isHeadwayTheme){MP.Flash.setFlash(localStorage.getItem("CENeedHeadwayThemeGrid"),"error");MP.Flash.showMessage()}else{MP.Flash.setFlash(localStorage.getItem("CENeedContentOutput"),"error");MP.Flash.showMessage()}}this.element.removeClass("motopress-tmp-iframe-width");var sceneContentWidth=sceneContent.width();iframeBody.addClass("motopress-body");sceneContent.find("script").remove();var wrappers=sceneContent.parents();var lastIndex=wrappers.length-3;sceneContent.siblings(":not(link, style, script)").remove();wrappers.each(function(i){$(this).addClass("motopress-content-wrapper-default");$(this).siblings(":not(link, style, script)").remove();return(i<lastIndex)});sceneContent.wrap('<div class="mp-span12" />').parent().wrap('<div class="mp-row-fluid motopress-row" />').parent().wrap('<div id="motopress-container" class="mp-container" />');var sceneContainer=sceneContent.closest("#motopress-container");if(sceneContentWidth<400){sceneContentWidth=400;sceneContainer.css("min-width",sceneContentWidth);this.grid.css("min-width",sceneContentWidth)}else{if(sceneContentWidth>1170){sceneContentWidth=1170}}sceneContainer.css("max-width",sceneContentWidth);this.grid.css("max-width",sceneContentWidth);var bgLightButton=$('<div class="motopress-scene-light"></div>');var bgDarkButton=$('<div class="motopress-scene-dark"></div>');sceneContainer.append($('<div class="motopress-scene-color"></div>').append(bgLightButton,bgDarkButton));var setSceneDark=function(){sceneContainer.addClass("mp-container-dark");iframeBody.addClass("mp-scene-dark")};if(sessionStorage.getItem("motopressSceneIsDark")=="true"){setSceneDark()}bgLightButton.on("click",function(){sceneContainer.removeClass("mp-container-dark");iframeBody.removeClass("mp-scene-dark");sessionStorage.setItem("motopressSceneIsDark","false")});bgDarkButton.on("click",function(){setSceneDark();sessionStorage.setItem("motopressSceneIsDark","true")});this.unwrapGrid(iframeBody);iframeBody.prepend(this.grid);var moreHandler=sceneContainer.find(".motopress-more-handler");if(!moreHandler.length){moreHandler=jQuery("<div />",{"class":"motopress-more-handler motopress-more-handler-disabled"});moreHandler.prependTo(sceneContainer.find(".motopress-content-wrapper"))}moreHandler.attr("title",localStorage.getItem("CEMoreHandlerTitle"));var moreHandlerWrapper=moreHandler.closest(".motopress-content-wrapper>.motopress-row");if(moreHandlerWrapper.length){moreHandler.insertAfter(moreHandlerWrapper)}$("body").hide(0,function(){$("body").show()});$.ajax({url:motopress.ajaxUrl,data:{action:"motopress_ce_remove_temporary_post",nonce:motopressCE.nonces.motopress_ce_remove_temporary_post,post_id:CE.Iframe.tmpPostId,postID:motopressCE.postID},type:"POST",error:function(jqXHR){var error=$.parseJSON(jqXHR.responseText);if(error.debug){console.log(error.message)}else{MP.Flash.setFlash(error.message,"error");MP.Flash.showMessage()}}})},unwrapGrid:function(iframeBody){iframeBody.find('div[data-motopress-group="grid"]').each(function(){var name=$(this).attr("data-motopress-shortcode");var attrs=$(this).attr("data-motopress-parameters");var styles=$(this).attr("data-motopress-styles");var child=$(this).children("div");child.attr("data-motopress-shortcode",name);if(attrs.length){child.attr("data-motopress-parameters",attrs)}if(styles.length){child.attr("data-motopress-styles",styles)}child.unwrap()})},renderContent:function(content){if(typeof content==="undefined"){content=""}content=content.replace(/(?:<p>)?<!--more(.*?)?-->(?:<\/p>)?/,'<div class="motopress-more-handler"></div>').replace(/(?:<p>)?<!--more(.*?)?-->(?:<\/p>)?/,"");var postId=$("#motopress-ce-btn").attr("data-post-id");$.ajax({url:motopress.ajaxUrl,type:"POST",dataType:"json",data:{action:"motopress_ce_render_content",nonce:motopressCE.nonces.motopress_ce_render_content,data:content,post_id:postId,postID:motopressCE.postID},success:function(data){CE.Iframe.tmpPostId=data.post_id;var src=MP.Utils.addParamToUrl(data.src,"motopress-ce",1);CE.Iframe.window.location.replace(src);var expr=new RegExp("\\[mp_row(|\\d{1,2})\\]","ig");if(content.length&&!expr.test(content)){MP.Flash.setFlash(localStorage.getItem("CEDefaultWPEditor"),"info");MP.Flash.showMessage()}CE.Iframe.myThis.isHeadwayTheme=data.hasOwnProperty("headway_themes")&&data.headway_themes===true;MP.Preloader.myThis.load(CE.Iframe.shortName)},error:function(jqXHR){console.log(jqXHR.responseText);var error=$.parseJSON(jqXHR.responseText);console.log(error.message)}})},getTinyMCEContent:function(){if(typeof tinyMCE!=="undefined"){var activeMode=MP.Utils.getEditorActiveMode($("#wp-content-wrap").prop("class").split(" "));CE.Iframe.wpEditor=tinyMCE.get("content");if(activeMode==="html-active"){switchEditors.switchto($("#content-tmce")[0]);if(typeof CE.Iframe.wpEditor==="undefined"||CE.Iframe.wpEditor===null){if(tinyMCE.majorVersion=="4"){tinyMCE.on("AddEditor",function(args){if(args.editor.id==="content"){args.editor.on("init",function(ed){CE.Iframe.wpEditor=args.editor;CE.Iframe.myThis.renderContent(args.editor.getContent({format:"html"}))})}})}else{tinyMCE.onAddEditor.add(function(mce,ed){if(ed.editorId==="content"){ed.onInit.add(function(ed){CE.Iframe.wpEditor=ed;CE.Iframe.myThis.renderContent(ed.getContent({format:"html"}))})}})}}else{this.renderContent(CE.Iframe.wpEditor.getContent({format:"html"}))}}else{this.renderContent(CE.Iframe.wpEditor.getContent({format:"html"}))}}else{var content=(CE.Iframe.wpTextarea.val().length)?switchEditors._wp_Autop(CE.Iframe.wpTextarea.val()).replace(new RegExp("\n","g"),""):"";this.renderContent(content)}},appendScript:function(head,script){head.appendChild(script)},prependScript:function(parent,script){parent.insertBefore(script,parent.firstChild)},wpLinkCloseCallback:function(callback){$("#wp-link").on("wpdialogclose.motopress",function(e){$("#wp-link").off("wpdialogclose.motopress");callback()})}})});steal("jquery/controller").then("mp/ce/save/save.js"+motopress.pluginVersionParam).then(function($){$.Controller("CE.Navbar",{myThis:null},{iframe:$("#motopress-content-editor-scene"),scrollWidth:15,postStatus:null,postNameObj:null,postNameObjInput:null,wpPostNameForm:null,wpPostNameFormPrompt:null,wpPostName:null,tutorialsCounter:0,init:function(el){CE.Navbar.myThis=this;CE.Iframe.myThis=null;this.wpPostNameForm=$('form[name="post"] input[name="post_title"]');this.wpPostNameFormPrompt=$('form[name="post"] #title-prompt-text');this.postNameObj=el.find(".motopress-page-name #motopress-title");this.postNameObjInput=el.find(".motopress-page-name").children("#motopress-input-edit-title");this.setupBtns();$('link[href*="js_composer"]').remove();this.showContentEditor();$("#motopress-ce-btn").on("click",function(){var pluginAutoSaved=sessionStorage.getItem("motopressPluginAutoSaved");pluginAutoSaved=(pluginAutoSaved&&pluginAutoSaved==="true")?true:false;if(!pluginAutoSaved){MP.Preloader.myThis.reopen();new MP.Preloader($("#motopress-preload"));new CE.Iframe($("#motopress-content-editor-scene"));CE.Navbar.myThis.showContentEditor()}});if($("#motopress-content-editor-scene-wrapper").height()===0){var h1=$("#motopress-content-editor-scene-wrapper").parent().height()-53;if(h1>0){$("#motopress-content-editor-scene-wrapper").height(h1)}var h2=$("#motopress-content-editor").parent().height()-32;if(h2>0){$("#motopress-content-editor").height(h2)}$(window).resize(function(){var h1=$("#motopress-content-editor-scene-wrapper").parent().height()-53;if(h1>0){$("#motopress-content-editor-scene-wrapper").height(h1)}var h2=$("#motopress-content-editor").parent().height()-32;if(h2>0){$("#motopress-content-editor").height(h2)}})}MP.Preloader.myThis.load(CE.Navbar.shortName)},onIframeLoad:function(iframe){this.wpPostName=this.wpPostNameForm.val();if(this.wpPostName.length===0){this.postNameObj.empty().append($("<i />",{text:localStorage.getItem("CEEmptyPostTitle")}));this.postNameObjInput.val("")}else{this.postNameObj.text(this.wpPostName);this.postNameObjInput.val(this.wpPostName)}this.scrollWidth=MP.Utils.getScrollbarWidth();var minWidth=this.scrollWidth+724+80;iframe.css("min-width",minWidth);$(".motopress-content-editor-navbar.ce_navbar").css("min-width",minWidth)},setupBtns:function(){var saveBtn=$("form#post input#save-post");var btnText="";if(saveBtn.length){this.postStatus="draft";btnText=localStorage.getItem("CEPublishBtnText")}else{this.postStatus="published";btnText=localStorage.getItem("CEUpdateBtnText");$("#motopress-content-editor-save").hide()}$("#motopress-content-editor-publish").text(btnText)},"#motopress-title click":function(el,e){this.postNameObj.hide();this.postNameObjInput.show().select()},"#motopress-input-edit-title blur":function(el,e){var self=el[0];if(self.value==""){this.postNameObj.empty().append($("<i />",{text:localStorage.getItem("CEEmptyPostTitle")}));this.wpPostNameForm.val(self.value);this.wpPostNameFormPrompt.removeClass("screen-reader-text")}else{this.postNameObj.text(self.value);this.wpPostNameForm.val(self.value);this.wpPostNameFormPrompt.addClass("screen-reader-text")}this.postNameObjInput.hide();this.postNameObj.show()},"#motopress-input-edit-title keypress":function(el,event){var self=el[0];if(event.keyCode=="13"){if(self.value==""){this.postNameObj.empty().append($("<i />",{text:localStorage.getItem("CEEmptyPostTitle")}));this.wpPostNameForm.val(self.value);this.wpPostNameFormPrompt.removeClass("screen-reader-text")}else{this.postNameObj.text(self.value);this.wpPostNameForm.val(self.value);this.wpPostNameFormPrompt.addClass("screen-reader-text")}this.postNameObjInput.hide();this.postNameObj.show()}},"#motopress-content-editor-tutorials click":function(e){var modalData=jQuery("#motopress-tutorials-modal"),bodyBG=jQuery("body");modalData.modal("toggle");if(this.tutorialsCounter===0){jQuery.ajax({type:"post",dataType:"html",url:motopress.ajaxUrl,data:{action:"motopress_tutorials"},success:function(response){if(response!=0&&response!="nothing"){modalData.find(".modal-body").html(response)}else{modalData.find(".modal-body").html("<h1>Error: can't load tutorials.<h1>")}}})}this.tutorialsCounter++},"#motopress-content-editor-publish click":function(){CE.Save.save();MP.Preloader.myThis.show();this.setPluginAutoOpen(true);$("form#post #publish").click()},"#motopress-content-editor-save click":function(){CE.Save.save();MP.Preloader.myThis.show();this.setPluginAutoOpen(true);$("form#post #save-post").click()},"#motopress-content-editor-preview click":function(){CE.Save.save();$("form#post #post-preview").click()},"#motopress-content-editor-delete click":function(){CE.Iframe.window.CE.Tools.myThis.removeBlock();CE.Save.changeContent()},"#motopress-content-editor-close click":function(){CE.Save.save();this.hideContentEditor();$("#motopress-content-editor-scene").off("load");MP.Utils.removeWindowFix();MP.Utils.removeWpFrontEndEditorFix();this.hideObjectControlBtns()},hideContentEditor:function(){MP.Error.terminate()},showContentEditor:function(){$("html").css({overflow:"hidden",paddingTop:0});$("#motopress-content-editor").siblings(':not("#'+MP.Preloader.myThis.element.attr("id")+', script, link")').each(function(){if(!$(this).is(":hidden")){$(this).addClass("motopress-hide")}});$("#wpwrap").height("100%").children("#wpcontent").children("#wpadminbar").prependTo("body");$("#motopress-content-editor").show()},showObjectControlBtns:function(){$(".motopress-object-control-btns").css("display","inline-block")},hideObjectControlBtns:function(){$(".motopress-object-control-btns").hide()},setPluginAutoOpen:function(value){sessionStorage.setItem("motopressPluginAutoOpen",value)},getPluginAutoOpen:function(){sessionStorage.getItem("motopressPluginAutoOpen")}})});steal("jquery/class").then("mp/core/language/language.js"+motopress.pluginVersionParam,function($){$.Class("MP.Settings",{siteUrl:null,debug:null,adminUrl:null,pluginRootUrl:null,pluginName:null,palettes:null,lang:null,langName:null,langCode:null,loadScriptsUrl:null,spellcheck:null,saveExcerpt:null,setup:function(){if(typeof CE==="undefined"){this.removeWpPanels()}this.getSiteUrl();this.getWpSettings()},removeWpPanels:function(){$("#footer, #adminmenuwrap, #adminmenuback, .update-nag").remove();$("#wpcontent").css("margin-left",0);$("#wpbody-content").css("padding-bottom",0);$("#wpfooter").remove()},getSiteUrl:function(){var href=window.location.href;var hrefLen=href.indexOf("/wp-admin/");this.siteUrl=href.substr(0,hrefLen)},getWpSettings:function(){var nonce=null;var postID=null;if(typeof motopressLE!=="undefined"){nonce=motopressLE.nonces.motopress_ce_get_wp_settings;postID=false}else{nonce=motopressCE.nonces.motopress_ce_get_wp_settings;postID=motopressCE.postID}$.ajax({url:motopress.ajaxUrl,data:{action:"motopress_ce_get_wp_settings",nonce:nonce,postID:postID},dataType:"json",type:"POST",success:function(data){MP.Settings.debug=data.debug;MP.Settings.adminUrl=data.admin_url;MP.Settings.pluginRootUrl=data.plugin_root_url;MP.Settings.pluginName=data.plugin_name;MP.Settings.palettes=data.palettes;MP.Settings.licenseType=data.license_type;MP.Settings.lang=data.lang;MP.Settings.loadScriptsUrl=data.load_scripts_url;MP.Settings.spellcheck=data.spellcheck=="1";MP.Settings.saveExcerpt=data.save_excerpt==="1";if(MP.Utils.Browser.IE||MP.Utils.Browser.Opera){window.location=MP.Settings.adminUrl+"?page="+MP.Settings.pluginName}new MP.Language()},error:function(){MP.Flash.setFlash(localStorage.getItem("wpSettingsError"),"error");MP.Flash.showMessage()}})}},{})});steal("jquery/controller",function($){$.Controller("CE.CodeModal",{myThis:null,currentSpan:null,currentTextareaTinymce:null,listensTo:["show","shown","hide"]},{iframeBody:null,content:null,editor:null,saveBtn:null,saveHandler:null,init:function(){CE.CodeModal.myThis=this;this.content=this.element.find("#motopresscodecontent");if(typeof tinyMCE!=="undefined"&&typeof tinyMCE.get("motopresscodecontent")!=="undefined"){this.editor=tinyMCE.get("motopresscodecontent")}this.saveBtn=this.element.find("#motopress-save-code-content");var tools=this.element.find("#wp-motopresscodecontent-editor-tools");if(tools.height()===0){tools.height(33)}this.element.modal({show:false});$(window).on("resize",this.proxy("resize"));MP.Utils.addWindowFix()},setSize:function(isHidden){var footer=this.element.find(".modal-footer");var footerWidth=this.element.width()-(parseFloat(footer.css("padding-left"))+parseFloat(footer.css("padding-right")));footer.width(footerWidth);var body=this.element.find(".modal-body");var bodyHeight=this.element.height()-this.element.find(".modal-header").outerHeight()-parseFloat(body.css("margin-top"))-parseFloat(body.css("margin-bottom"))-footer.outerHeight();body.height(bodyHeight);if(isHidden){this.element.css({display:"block",visibility:"hidden"})}var container=this.element.find("#wp-motopresscodecontent-editor-container");var containerHeight=this.element.find("#wp-motopresscodecontent-wrap").height()-this.element.find("#wp-motopresscodecontent-editor-tools").height()-parseFloat(container.css("border-top-width"))-parseFloat(container.css("border-bottom-width"));container.height(containerHeight);var contentHeight=containerHeight-parseFloat(container.css("border-top-width"))-parseFloat(container.css("border-bottom-width"))-this.element.find("#qt_motopresscodecontent_toolbar").outerHeight()-parseFloat(this.content.css("padding-top"))-parseFloat(this.content.css("padding-bottom"));this.content.height(contentHeight);var contentIfr=this.element.find("#motopresscodecontent_ifr");var mceFirst=container.find(".mce-first, tr.mceFirst").first();var mceLast=container.find(".mce-statusbar, tr.mceLast").last();var contentIfrHeight=containerHeight-parseFloat(container.css("border-top-width"))-parseFloat(container.css("border-bottom-width"))-mceFirst.outerHeight()-mceLast.outerHeight();contentIfr.height(contentIfrHeight);if(isHidden){this.element.css({display:"",visibility:""});this.content.removeAttr("rows")}},resize:function(){if(this.element.data("modal").isShown){this.setSize(false)}},show:function(el,e){this.setSize(true);this.switchVisual();if(this.saveHandler!==null&&typeof this.saveHandler==="function"){this.saveBtn.off("click").on("click",this.saveHandler)}if(this.iframeBody===null){this.iframeBody=this.element.find("#motopresscodecontent_ifr").contents().find(".motopresscodecontent");this.iframeBody.css("max-width","none")}if(CE.Iframe.window.CE.Dialog.myThis.element.dialog("isOpen")&&!el.data("modal").hasOwnProperty("closeDialog")){CE.Iframe.window.CE.Dialog.myThis.element.dialog("close")}},shown:function(){if(this.editor!==null){this.editor.execCommand("mceFocus",false)}else{this.content.focus()}$("body").hide(0,function(){$("body").show()})},hide:function(el,e){CE.CodeModal.currentSpan.find(".motopress-drag-handle").prev().focus();this.content.val("");if(this.editor!==null){this.editor.setContent("")}this.saveHandler=null;if(CE.Iframe.wpEditor!==null){CE.Iframe.wpEditor.focus()}if(el.data("modal").hasOwnProperty("closeDialog")){delete el.data("modal").closeDialog}if(!CE.Iframe.window.CE.Dialog.myThis.element.dialog("isOpen")){var dragHandle=CE.CodeModal.currentSpan.find(".motopress-drag-handle");CE.Iframe.window.CE.Dialog.myThis.open(dragHandle)}var t=setTimeout(function(){CE.CodeModal.currentSpan=null;CE.CodeModal.currentTextareaTinymce=null;clearTimeout(t)},0)},switchVisual:function(){var activeMode=MP.Utils.getEditorActiveMode(this.element.find("#wp-motopresscodecontent-wrap").prop("class").split(" "));if(typeof tinyMCE!=="undefined"&&activeMode==="html-active"){switchEditors.switchto(this.element.find("#motopresscodecontent-tmce")[0]);if(this.editor===null){this.editor=tinyMCE.get("motopresscodecontent")}}}})});